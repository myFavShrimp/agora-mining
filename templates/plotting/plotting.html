{% let (style_sheet, class_name) = turf::inline_style_sheet!("templates/plotting/plotting.scss") %}
<!-- @formatter:off -->
<style>
    {{ style_sheet }}
</style>
<!-- @formatter:on -->

<form>
    <div class="{{class_name.graph_toolbar}}">
        <div class="{{class_name.graph_toolbar_item}}">
            <label for="from">Von</label>
            <input class="{{class_name.graph_toolbar_datepicker}}" id="from" name="from_date" type="date">
        </div>
        <div class="{{class_name.graph_toolbar_item}}">
            <label for="to">Bis</label>
            <input class="{{class_name.graph_toolbar_datepicker}}" id="to" name="to_date" type="date">
        </div>
        <div class="{{class_name.graph_toolbar_item}}">
            <a class="{{class_name.refresh}}" hx-get="/refresh">
                    <span class="{{class_name.link_text}}"
                          id="{{crate::templates::REFRESH_BUTTON_ID}}">Refresh</span>
                <span class="{{class_name.spinner}}"></span>
            </a>
        </div>
    </div>
    <div class={{class_name.chart_container}}>
        <canvas id="myChart"></canvas>
    </div>
</form>

<script>
    var ctx = document.getElementById('myChart');
    const lineColor = '#7e767e';
    const textColor = '#cfc3cd';
    <!-- @formatter:off -->
    const chartData = {{ serde_json::to_string(data_sets).unwrap()|safe }};
    <!-- @formatter:on -->

    new Chart(ctx, {
        type: 'line',
        data: {
            datasets: chartData,
        },
        options: {
            elements: {
                point: {
                    radius: 3,
                    hoverRadius: 4,
                    hitRadius: 0,
                },
            },
            plugins: {
                tooltip: {
                    mode: 'x',
                    callbacks: {
                        label: function (context) {
                            return `${context.dataset.label}: ${context.formattedValue} ${context.dataset.unit}`;
                        }
                    }
                },
                legend: {
                    labels: {
                        color: textColor,
                    },
                },
            },
            scales: {
                y: {
                    type: 'logarithmic',
                    ticks: {
                        color: textColor,
                    },
                    grid: {
                        color: lineColor,
                    },
                },
                x: {
                    ticks: {
                        color: textColor,
                    },
                    grid: {
                        color: lineColor,
                    },
                }
            }
        }
    });
</script>
